<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Mayday Plumbing</title>
    <meta name="description" content="Stay updated with the latest plumbing tips, news, and insights from Mayday Plumbing.">
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link rel="stylesheet" href="/static/css/index.css">
    <link href="https://fonts.googleapis.com/css2?family={{ font_settings.heading_font|replace(' ', '+') }}:wght@300;400;500;600;700&family={{ font_settings.body_font|replace(' ', '+') }}:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Dynamic font settings from database -->
    <style>
        :root {
            --font-heading: '{{ font_settings.heading_font }}', sans-serif;
            --font-body: '{{ font_settings.body_font }}', sans-serif;
        }

        {% if font_settings.custom_css %}
        /* Custom CSS from admin panel */
        {{ font_settings.custom_css|safe }}
        {% endif %}
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="/static/img/mayday-translucent.png" alt="Mayday Plumbing Logo">
                <span>Mayday Plumbing</span>
            </div>
            <div class="nav-menu">
                <a href="/" class="nav-link">Home</a>
                <a href="/#services" class="nav-link">Services</a>
                <a href="/about" class="nav-link">About</a>
                <a href="/#contact" class="nav-link">Contact</a>
                <a href="/blog" class="nav-link active">Blog</a>
                <a href="https://client.housecallpro.com/customer_portal/request-link?token=e57304ab4e974b93a5b90c2084ba3d1a" target="_blank" class="nav-link">Invoices</a>
                {% if admin == true %}
                <a href="/#admin" class="nav-link">Admin</a>
                <a href="/logout" class="nav-link">Logout</a>
                {% endif %}
            </div>
            <div class="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Blog Header -->
    <section class="blog-header">
        <div class="container">
            <h1>{{ descriptions.get('blog-title', 'Plumbing Tips & News') }}</h1>
            <p>{{ descriptions.get('blog-subtitle', 'Stay informed with expert advice, industry updates, and helpful tips from our experienced team.') }}</p>
        </div>
    </section>

    <!-- Admin Blog Creation -->
    {% if admin == true %}
    <section class="admin-blog-section">
        <div class="container">
            <div class="admin-blog-panel">
                <h2><i class="fas fa-plus-circle"></i> Create New Blog Post</h2>
                <form id="blogForm" class="blog-form">
                    <div class="form-group">
                        <label for="blogTitle">Title</label>
                        <input type="text" id="blogTitle" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="blogAuthor">Author</label>
                        <input type="text" id="blogAuthor" name="author" value="Mayday Plumbing Team">
                    </div>
                    
                    <div class="form-group">
                        <label for="blogImage">Featured Image</label>
                        <div class="image-upload-container">
                            <input type="file" id="blogImage" name="image" accept="image/*">
                            <div class="image-preview" id="imagePreview" style="display: none;">
                                <img id="previewImg" src="" alt="Preview">
                                <div class="image-controls">
                                    <label for="imageSize">Image Size:</label>
                                    <select id="imageSize" name="imageSize">
                                        <option value="small">Small (300px)</option>
                                        <option value="medium" selected>Medium (500px)</option>
                                        <option value="large">Large (700px)</option>
                                        <option value="full">Full Width</option>
                                    </select>
                                    <button type="button" id="removeImage" class="btn-delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="blogContent">Content</label>
                        <div class="content-editor">
                            <div class="editor-toolbar">
                                <button type="button" class="editor-btn" data-command="bold" title="Bold">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button type="button" class="editor-btn" data-command="italic" title="Italic">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button type="button" class="editor-btn" data-command="underline" title="Underline">
                                    <i class="fas fa-underline"></i>
                                </button>
                                <button type="button" class="editor-btn" data-command="insertUnorderedList" title="Bullet List">
                                    <i class="fas fa-list-ul"></i>
                                </button>
                                <button type="button" class="editor-btn" data-command="insertOrderedList" title="Numbered List">
                                    <i class="fas fa-list-ol"></i>
                                </button>
                                <button type="button" class="editor-btn" data-command="createLink" title="Add Link">
                                    <i class="fas fa-link"></i>
                                </button>
                            </div>
                            <div id="blogContent" contenteditable="true" class="content-area" placeholder="Write your blog post content here..."></div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Publish Post
                        </button>
                        <button type="button" id="previewBtn" class="btn btn-secondary">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Blog Posts -->
    <section class="blog-posts-section">
        <div class="container">
            <div class="blog-grid" id="blogGrid">
                <!-- Blog posts loaded from database -->
                {% for post in blog_posts %}
                {% set post_image = post.image_data or post.image or '' %}
                <div class="blog-post-card" data-post-data='{"id":{{ post.id }},"title":"{{ post.title|replace('"', '\\"')|replace('\n', '\\n')|replace('\r', '\\r') }}","author":"{{ post.author|replace('"', '\\"') }}","date":"{{ post.created_at.strftime('%B %d, %Y') if post.created_at else '' }}","content":"{{ post.content|replace('"', '\\"')|replace('\n', '\\n')|replace('\r', '\\r')|replace('\t', '\\t') }}","image":"{{ post_image|replace('"', '\\"') }}","imageSize":"{{ post.image_size or 'medium' }}"}'>
                    {% if post_image %}
                    <div class="blog-post-image">
                        <img src="{{ post_image }}" alt="{{ post.title }}">
                    </div>
                    {% endif %}
                    <div class="blog-post-content">
                        <div class="blog-post-meta">
                            <span class="blog-date">{{ post.created_at.strftime('%B %d, %Y') if post.created_at else '' }}</span>
                            <span class="blog-author">{{ post.author }}</span>
                        </div>
                        <h3>{{ post.title }}</h3>
                        <p>{{ (post.content|striptags)[:150] }}...</p>
                        <a href="#" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                        {% if admin == true %}
                        <div class="admin-actions">
                            <button class="btn-edit" title="Edit Post">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-delete" title="Delete Post">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <!-- Show welcome post if no posts exist -->
                {% set welcome_content = '<p>We are excited to share our expertise and insights with you through our new blog!</p><p>Here you will find:</p><ul><li><strong>Expert Plumbing Tips</strong> - Learn how to maintain your plumbing systems and prevent common issues</li><li><strong>Industry News</strong> - Stay updated on the latest plumbing technologies and trends</li><li><strong>Seasonal Advice</strong> - Get tips for protecting your pipes during winter and preparing for spring</li><li><strong>Emergency Prevention</strong> - Learn how to spot warning signs before they become major problems</li><li><strong>DIY vs Professional</strong> - Understand when you can handle repairs yourself and when to call the experts</li></ul><p>Our team at Mayday Plumbing has been serving the Salem, Roanoke, and surrounding Virginia areas for years. We are licensed, insured, and ready to provide professional plumbing services.</p><p>Check back regularly for new posts, and do not hesitate to contact us if you have any plumbing questions or need professional service!</p>' %}
                <div class="blog-post-card" data-post-data='{"title":"Welcome to Our Blog","author":"Mayday Plumbing Team","date":"December 15, 2024","content":"{{ welcome_content|replace('"', '\\"')|replace('\n', '\\n')|replace('\r', '\\r') }}","image":"/static/img/hero-bg.jpg","imageSize":"medium"}'>
                    <div class="blog-post-image">
                        <img src="/static/img/hero-bg.jpg" alt="Welcome to our blog">
                    </div>
                    <div class="blog-post-content">
                        <div class="blog-post-meta">
                            <span class="blog-date">December 15, 2024</span>
                            <span class="blog-author">Mayday Plumbing Team</span>
                        </div>
                        <h3>Welcome to Our Blog</h3>
                        <p>We're excited to share our expertise and insights with you. Stay tuned for helpful plumbing tips, industry news, and more!</p>
                        <a href="#" class="read-more">Read More <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Load More Button -->
            <div class="blog-load-more">
                <button class="btn btn-secondary" id="loadMoreBtn">
                    <i class="fas fa-plus"></i> Load More Posts
                </button>
            </div>
        </div>
    </section>

    <!-- Blog Post Modal -->
    <div id="blogModal" class="blog-modal" style="display: none;">
        <div class="blog-modal-content" id="blogModalContent">
            <div class="blog-modal-header">
                <h3 id="blogModalTitle" style="margin: 0; color: var(--text-primary);"></h3>
                <div class="blog-modal-controls">
                    <button class="blog-modal-fullscreen" id="blogModalFullscreen" title="Toggle Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="blog-modal-close" id="blogModalClose">&times;</button>
                </div>
            </div>
            <div class="blog-modal-body" id="blogModalBody">
                <!-- Blog post content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="/static/img/mayday-translucent.png" alt="Mayday Plumbing Logo">
                        <h3>Mayday Plumbing LLC</h3>
                    </div>
                    <p>The Help Behind Every Mayday! Licensed, bonded, and insured.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/admin-login">Admin Login</a></li>
                        <li><a href="/#services">Services</a></li>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/#contact">Contact</a></li>
                        <li><a href="/#faq">FAQ</a></li>
                        <li><a href="/blog">Blog</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="/#services">Leak Detection & Repair</a></li>
                        <li><a href="/#services">Plumbing Fixture Installation</a></li>
                        <li><a href="/#services">Water Heater Services</a></li>
                        <li><a href="/#services">Whole Home Repipe</a></li>
                        <li><a href="/#services">Sump & Sewage Pump Services</a></li>
                        <li><a href="/#services">Drain Cleaning & Jetting</a></li>
                        <li><a href="/#services">Sewer Line Services</a></li>
                        <li><a href="/#services">Plumbing Inspections</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <p><i class="fas fa-phone"></i> <a class="phone-link" href="tel:5405214181">(540) 521-4181</a></p>
                    <p><i class="fas fa-map-marker-alt"></i> Serving Virginia Areas</p>
                    <p><i class="fas fa-clock"></i> Mon-Fri: 8:00AM-4:00PM</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Mayday Plumbing LLC. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-header">
                <div id="confirmModalIcon" class="confirm-modal-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                <h3 id="confirmModalTitle" class="confirm-modal-title">Confirm Action</h3>
                <p id="confirmModalMessage" class="confirm-modal-message">Are you sure you want to proceed?</p>
            </div>
            <div class="confirm-modal-actions">
                <button id="confirmModalCancel" class="confirm-btn confirm-btn-cancel">Cancel</button>
                <button id="confirmModalConfirm" class="confirm-btn confirm-btn-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <script src="/static/js/blog.js"></script>
    <script src="/static/js/index.js"></script>
</body>
</html>